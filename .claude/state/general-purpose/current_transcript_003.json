[
  {
    "role": "user",
    "content": [
      {
        "tool_use_id": "toolu_01LU1BFC94auV6kawkJgCgjb",
        "type": "tool_result",
        "content": "     1â†’#!/usr/bin/env node\n     2â†’\n     3â†’/**\n     4â†’ * Claude Code Sessions Framework - Node.js Installer\n     5â†’ * Cross-platform installation script for the Sessions framework\n     6â†’ */\n     7â†’\n     8â†’const fs = require('fs').promises;\n     9â†’const path = require('path');\n    10â†’const { execSync } = require('child_process');\n    11â†’const readline = require('readline');\n    12â†’const { promisify } = require('util');\n    13â†’\n    14â†’// Colors for terminal output\n    15â†’const colors = {\n    16â†’  reset: '\\x1b[0m',\n    17â†’  bright: '\\x1b[1m',\n    18â†’  dim: '\\x1b[2m',\n    19â†’  red: '\\x1b[31m',\n    20â†’  green: '\\x1b[32m',\n    21â†’  yellow: '\\x1b[33m',\n    22â†’  blue: '\\x1b[34m',\n    23â†’  magenta: '\\x1b[35m',\n    24â†’  cyan: '\\x1b[36m',\n    25â†’  white: '\\x1b[37m',\n    26â†’  bgRed: '\\x1b[41m',\n    27â†’  bgGreen: '\\x1b[42m',\n    28â†’  bgYellow: '\\x1b[43m',\n    29â†’  bgBlue: '\\x1b[44m',\n    30â†’  bgMagenta: '\\x1b[45m',\n    31â†’  bgCyan: '\\x1b[46m'\n    32â†’};\n    33â†’\n    34â†’// Helper to colorize output\n    35â†’const color = (text, colorCode) => `${colorCode}${text}${colors.reset}`;\n    36â†’\n    37â†’// Icons and symbols\n    38â†’const icons = {\n    39â†’  check: 'âœ“',\n    40â†’  cross: 'âœ—',\n    41â†’  lock: 'ğŸ”’',\n    42â†’  unlock: 'ğŸ”“',\n    43â†’  info: 'â„¹',\n    44â†’  warning: 'âš ',\n    45â†’  arrow: 'â†’',\n    46â†’  bullet: 'â€¢',\n    47â†’  star: 'â˜…'\n    48â†’};\n    49â†’\n    50â†’// Create readline interface\n    51â†’const rl = readline.createInterface({\n    52â†’  input: process.stdin,\n    53â†’  output: process.stdout\n    54â†’});\n    55â†’\n    56â†’const question = promisify(rl.question).bind(rl);\n    57â†’\n    58â†’// Paths\n    59â†’const SCRIPT_DIR = __dirname;\n    60â†’let PROJECT_ROOT = process.cwd();\n    61â†’\n    62â†’// Check if we're running from npx or in wrong directory\n    63â†’async function detectProjectDirectory() {\n    64â†’  // If running from node_modules or temp npx directory\n    65â†’  if (PROJECT_ROOT.includes('node_modules') || PROJECT_ROOT.includes('.npm')) {\n    66â†’    console.log(color('âš ï¸  Running from package directory, not project directory.', colors.yellow));\n    67â†’    console.log();\n    68â†’    const projectPath = await question('Enter the path to your project directory (or press Enter for current directory): ');\n    69â†’    if (projectPath) {\n    70â†’      PROJECT_ROOT = path.resolve(projectPath);\n    71â†’    } else {\n    72â†’      PROJECT_ROOT = process.cwd();\n    73â†’    }\n    74â†’    console.log(color(`Using project directory: ${PROJECT_ROOT}`, colors.cyan));\n    75â†’  }\n    76â†’}\n    77â†’\n    78â†’// Configuration object to build\n    79â†’const config = {\n    80â†’  developer_name: \"the developer\",\n    81â†’  trigger_phrases: [\"make it so\", \"run that\", \"go ahead\", \"yert\"],\n    82â†’  blocked_tools: [\"Edit\", \"Write\", \"MultiEdit\", \"NotebookEdit\"],\n    83â†’  task_detection: { enabled: true },\n    84â†’  branch_enforcement: { enabled: true }\n    85â†’};\n    86â†’\n    87â†’// Check if command exists\n    88â†’function commandExists(command) {\n    89â†’  try {\n    90â†’    execSync(`which ${command}`, { stdio: 'ignore' });\n    91â†’    return true;\n    92â†’  } catch {\n    93â†’    return false;\n    94â†’  }\n    95â†’}\n    96â†’\n    97â†’// Check dependencies\n    98â†’async function checkDependencies() {\n    99â†’  console.log(color('Checking dependencies...', colors.cyan));\n   100â†’  \n   101â†’  // Check Python\n   102â†’  const hasPython = commandExists('python3') || commandExists('python');\n   103â†’  if (!hasPython) {\n   104â†’    console.log(color('âŒ Python 3 is required but not installed.', colors.red));\n   105â†’    process.exit(1);\n   106â†’  }\n   107â†’  \n   108â†’  // Check pip\n   109â†’  const hasPip = commandExists('pip3') || commandExists('pip');\n   110â†’  if (!hasPip) {\n   111â†’    console.log(color('âŒ pip is required but not installed.', colors.red));\n   112â†’    process.exit(1);\n   113â†’  }\n   114â†’  \n   115â†’  // Check Git (warning only)\n   116â†’  if (!commandExists('git')) {\n   117â†’    console.log(color('âš ï¸  Warning: Not in a git repository. Sessions works best with git.', colors.yellow));\n   118â†’    const answer = await question('Continue anyway? (y/n): ');\n   119â†’    if (answer.toLowerCase() !== 'y') {\n   120â†’      process.exit(1);\n   121â†’    }\n   122â†’  }\n   123â†’}\n   124â†’\n   125â†’// Create directory structure\n   126â†’async function createDirectories() {\n   127â†’  console.log(color('Creating directory structure...', colors.cyan));\n   128â†’  \n   129â†’  const dirs = [\n   130â†’    '.claude/hooks',\n   131â†’    '.claude/state',\n   132â†’    '.claude/agents',\n   133â†’    '.claude/commands',\n   134â†’    'sessions/tasks/done',\n   135â†’    'sessions/protocols',\n   136â†’    'sessions/knowledge'\n   137â†’  ];\n   138â†’  \n   139â†’  for (const dir of dirs) {\n   140â†’    await fs.mkdir(path.join(PROJECT_ROOT, dir), { recursive: true });\n   141â†’  }\n   142â†’}\n   143â†’\n   144â†’// Install Python dependencies\n   145â†’async function installPythonDeps() {\n   146â†’  console.log(color('Installing Python dependencies...', colors.cyan));\n   147â†’  try {\n   148â†’    const pipCommand = commandExists('pip3') ? 'pip3' : 'pip';\n   149â†’    execSync(`${pipCommand} install tiktoken --quiet`, { stdio: 'ignore' });\n   150â†’  } catch (error) {\n   151â†’    console.log(color('âš ï¸  Could not install tiktoken. You may need to install it manually.', colors.yellow));\n   152â†’  }\n   153â†’}\n   154â†’\n   155â†’// Copy files with proper permissions\n   156â†’async function copyFiles() {\n   157â†’  console.log(color('Installing hooks...', colors.cyan));\n   158â†’  const hookFiles = await fs.readdir(path.join(SCRIPT_DIR, 'cc_sessions/hooks'));\n   159â†’  for (const file of hookFiles) {\n   160â†’    if (file.endsWith('.py')) {\n   161â†’      await fs.copyFile(\n   162â†’        path.join(SCRIPT_DIR, 'cc_sessions/hooks', file),\n   163â†’        path.join(PROJECT_ROOT, '.claude/hooks', file)\n   164â†’      );\n   165â†’      await fs.chmod(path.join(PROJECT_ROOT, '.claude/hooks', file), 0o755);\n   166â†’    }\n   167â†’  }\n   168â†’  \n   169â†’  console.log(color('Installing protocols...', colors.cyan));\n   170â†’  const protocolFiles = await fs.readdir(path.join(SCRIPT_DIR, 'cc_sessions/protocols'));\n   171â†’  for (const file of protocolFiles) {\n   172â†’    if (file.endsWith('.md')) {\n   173â†’      await fs.copyFile(\n   174â†’        path.join(SCRIPT_DIR, 'cc_sessions/protocols', file),\n   175â†’        path.join(PROJECT_ROOT, 'sessions/protocols', file)\n   176â†’      );\n   177â†’    }\n   178â†’  }\n   179â†’  \n   180â†’  console.log(color('Installing agent definitions...', colors.cyan));\n   181â†’  const agentFiles = await fs.readdir(path.join(SCRIPT_DIR, 'cc_sessions/agents'));\n   182â†’  for (const file of agentFiles) {\n   183â†’    if (file.endsWith('.md')) {\n   184â†’      await fs.copyFile(\n   185â†’        path.join(SCRIPT_DIR, 'cc_sessions/agents', file),\n   186â†’        path.join(PROJECT_ROOT, '.claude/agents', file)\n   187â†’      );\n   188â†’    }\n   189â†’  }\n   190â†’  \n   191â†’  console.log(color('Installing templates...', colors.cyan));\n   192â†’  await fs.copyFile(\n   193â†’    path.join(SCRIPT_DIR, 'cc_sessions/templates/TEMPLATE.md'),\n   194â†’    path.join(PROJECT_ROOT, 'sessions/tasks/TEMPLATE.md')\n   195â†’  );\n   196â†’  \n   197â†’  console.log(color('Installing commands...', colors.cyan));\n   198â†’  const commandFiles = await fs.readdir(path.join(SCRIPT_DIR, 'cc_sessions/commands'));\n   199â†’  for (const file of commandFiles) {\n   200â†’    if (file.endsWith('.md')) {\n   201â†’      await fs.copyFile(\n   202â†’        path.join(SCRIPT_DIR, 'cc_sessions/commands', file),\n   203â†’        path.join(PROJECT_ROOT, '.claude/commands', file)\n   204â†’      );\n   205â†’    }\n   206â†’  }\n   207â†’  \n   208â†’  // Copy knowledge files if they exist\n   209â†’  const knowledgePath = path.join(SCRIPT_DIR, 'cc_sessions/knowledge/claude-code');\n   210â†’  try {\n   211â†’    await fs.access(knowledgePath);\n   212â†’    console.log(color('Installing Claude Code knowledge base...', colors.cyan));\n   213â†’    await copyDir(knowledgePath, path.join(PROJECT_ROOT, 'sessions/knowledge/claude-code'));\n   214â†’  } catch {\n   215â†’    // Knowledge files don't exist, skip\n   216â†’  }\n   217â†’}\n   218â†’\n   219â†’// Recursive directory copy\n   220â†’async function copyDir(src, dest) {\n   221â†’  await fs.mkdir(dest, { recursive: true });\n   222â†’  const entries = await fs.readdir(src, { withFileTypes: true });\n   223â†’  \n   224â†’  for (const entry of entries) {\n   225â†’    const srcPath = path.join(src, entry.name);\n   226â†’    const destPath = path.join(dest, entry.name);\n   227â†’    \n   228â†’    if (entry.isDirectory()) {\n   229â†’      await copyDir(srcPath, destPath);\n   230â†’    } else {\n   231â†’      await fs.copyFile(srcPath, destPath);\n   232â†’    }\n   233â†’  }\n   234â†’}\n   235â†’\n   236â†’// Install daic command\n   237â†’async function installDaicCommand() {\n   238â†’  console.log(color('Installing daic command...', colors.cyan));\n   239â†’  \n   240â†’  const daicSource = path.join(SCRIPT_DIR, 'cc_sessions/scripts/daic');\n   241â†’  const daicDest = '/usr/local/bin/daic';\n   242â†’  \n   243â†’  try {\n   244â†’    await fs.copyFile(daicSource, daicDest);\n   245â†’    await fs.chmod(daicDest, 0o755);\n   246â†’  } catch (error) {\n   247â†’    if (error.code === 'EACCES') {\n   248â†’      console.log(color('âš ï¸  Cannot write to /usr/local/bin. Trying with sudo...', colors.yellow));\n   249â†’      try {\n   250â†’        execSync(`sudo cp ${daicSource} ${daicDest}`, { stdio: 'inherit' });\n   251â†’        execSync(`sudo chmod +x ${daicDest}`, { stdio: 'inherit' });\n   252â†’      } catch {\n   253â†’        console.log(color('âš ï¸  Could not install daic command globally. You can run it locally from .claude/scripts/', colors.yellow));\n   254â†’      }\n   255â†’    }\n   256â†’  }\n   257â†’}\n   258â†’\n   259â†’// Interactive menu with keyboard navigation\n   260â†’async function interactiveMenu(items, options = {}) {\n   261â†’  const {\n   262â†’    title = 'Select an option',\n   263â†’    multiSelect = false,\n   264â†’    selectedItems = new Set(),\n   265â†’    formatItem = (item, selected) => item\n   266â†’  } = options;\n   267â†’  \n   268â†’  let currentIndex = 0;\n   269â†’  let selected = new Set(selectedItems);\n   270â†’  let done = false;\n   271â†’  \n   272â†’  // Hide cursor\n   273â†’  process.stdout.write('\\x1B[?25l');\n   274â†’  \n   275â†’  const renderMenu = () => {\n   276â†’    // Clear previous menu\n   277â†’    console.clear();\n   278â†’    \n   279â†’    // Render title\n   280â†’    if (title) {\n   281â†’      console.log(title);\n   282â†’    }\n   283â†’    \n   284â†’    // Render items\n   285â†’    items.forEach((item, index) => {\n   286â†’      const isSelected = selected.has(item);\n   287â†’      const isCurrent = index === currentIndex;\n   288â†’      \n   289â†’      let prefix = '  ';\n   290â†’      if (isCurrent) {\n   291â†’        prefix = color('â–¶ ', colors.cyan);\n   292â†’      }\n   293â†’      \n   294â†’      console.log(prefix + formatItem(item, isSelected, isCurrent));\n   295â†’    });\n   296â†’  };\n   297â†’  \n   298â†’  return new Promise((resolve) => {\n   299â†’    renderMenu();\n   300â†’    \n   301â†’    // Set raw mode for key input\n   302â†’    readline.emitKeypressEvents(process.stdin);\n   303â†’    if (process.stdin.setRawMode) {\n   304â†’      process.stdin.setRawMode(true);\n   305â†’    }\n   306â†’    process.stdin.resume();\n   307â†’    \n   308â†’    const keyHandler = (str, key) => {\n   309â†’      if (key) {\n   310â†’        if (key.name === 'up') {\n   311â†’          currentIndex = (currentIndex - 1 + items.length) % items.length;\n   312â†’          renderMenu();\n   313â†’        } else if (key.name === 'down') {\n   314â†’          currentIndex = (currentIndex + 1) % items.length;\n   315â†’          renderMenu();\n   316â†’        } else if (key.name === 'space' && multiSelect) {\n   317â†’          const item = items[currentIndex];\n   318â†’          if (selected.has(item)) {\n   319â†’            selected.delete(item);\n   320â†’          } else {\n   321â†’            selected.add(item);\n   322â†’          }\n   323â†’          renderMenu();\n   324â†’        } else if (key.name === 'return') {\n   325â†’          done = true;\n   326â†’          // Restore terminal\n   327â†’          if (process.stdin.setRawMode) {\n   328â†’            process.stdin.setRawMode(false);\n   329â†’          }\n   330â†’          process.stdin.removeListener('keypress', keyHandler);\n   331â†’          process.stdout.write('\\x1B[?25h'); // Show cursor\n   332â†’          console.clear();\n   333â†’          \n   334â†’          // Resume stdin for subsequent prompts (don't pause!)\n   335â†’          process.stdin.resume();\n   336â†’          \n   337â†’          if (multiSelect) {\n   338â†’            resolve(selected);\n   339â†’          } else {\n   340â†’            resolve(items[currentIndex]);\n   341â†’          }\n   342â†’        } else if (key.ctrl && key.name === 'c') {\n   343â†’          // Handle Ctrl+C\n   344â†’          if (process.stdin.setRawMode) {\n   345â†’            process.stdin.setRawMode(false);\n   346â†’          }\n   347â†’          process.stdin.pause();\n   348â†’          process.stdout.write('\\x1B[?25h'); // Show cursor\n   349â†’          process.exit(0);\n   350â†’        }\n   351â†’      }\n   352â†’    };\n   353â†’    \n   354â†’    process.stdin.on('keypress', keyHandler);\n   355â†’  });\n   356â†’}\n   357â†’\n   358â†’// Tool blocking menu\n   359â†’async function configureToolBlocking() {\n   360â†’  const allTools = [\n   361â†’    { name: 'Edit', description: 'Edit existing files', defaultBlocked: true },\n   362â†’    { name: 'Write', description: 'Create new files', defaultBlocked: true },\n   363â†’    { name: 'MultiEdit', description: 'Multiple edits in one operation', defaultBlocked: true },\n   364â†’    { name: 'NotebookEdit', description: 'Edit Jupyter notebooks', defaultBlocked: true },\n   365â†’    { name: 'Bash', description: 'Run shell commands', defaultBlocked: false },\n   366â†’    { name: 'Read', description: 'Read file contents', defaultBlocked: false },\n   367â†’    { name: 'Grep', description: 'Search file contents', defaultBlocked: false },\n   368â†’    { name: 'Glob', description: 'Find files by pattern', defaultBlocked: false },\n   369â†’    { name: 'LS', description: 'List directory contents', defaultBlocked: false },\n   370â†’    { name: 'WebSearch', description: 'Search the web', defaultBlocked: false },\n   371â†’    { name: 'WebFetch', description: 'Fetch web content', defaultBlocked: false },\n   372â†’    { name: 'Task', description: 'Launch specialized agents', defaultBlocked: false }\n   373â†’  ];\n   374â†’  \n   375â†’  // Initialize blocked tools\n   376â†’  const initialBlocked = new Set(config.blocked_tools.map(name => \n   377â†’    allTools.find(t => t.name === name)\n   378â†’  ).filter(Boolean));\n   379â†’  \n   380â†’  const title = `${color('â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®', colors.cyan)}\n   381â†’${color('â”‚              Tool Blocking Configuration                      â”‚', colors.cyan)}\n   382â†’${color('â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤', colors.cyan)}\n   383â†’${color('â”‚   â†‘/â†“: Navigate   SPACE: Toggle   ENTER: Save & Continue      â”‚', colors.dim)}\n   384â†’${color('â”‚     Tools marked with ğŸ”’ are blocked in discussion mode       â”‚', colors.dim)}\n   385â†’${color('â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯', colors.cyan)}\n   386â†’`;\n   387â†’  \n   388â†’  const formatItem = (tool, isBlocked, isCurrent) => {\n   389â†’    const icon = isBlocked ? icons.lock : icons.unlock;\n   390â†’    const status = isBlocked ? color('[BLOCKED]', colors.red) : color('[ALLOWED]', colors.green);\n   391â†’    const toolColor = isCurrent ? colors.bright : (isBlocked ? colors.yellow : colors.white);\n   392â†’    \n   393â†’    return `${icon} ${color(tool.name.padEnd(15), toolColor)} - ${tool.description.padEnd(30)} ${status}`;\n   394â†’  };\n   395â†’  \n   396â†’  const selectedTools = await interactiveMenu(allTools, {\n   397â†’    title,\n   398â†’    multiSelect: true,\n   399â†’    selectedItems: initialBlocked,\n   400â†’    formatItem\n   401â†’  });\n   402â†’  \n   403â†’  config.blocked_tools = Array.from(selectedTools).map(t => t.name);\n   404â†’  console.log(color(`\\n  ${icons.check} Tool blocking configuration saved`, colors.green));\n   405â†’}\n   406â†’\n   407â†’// Interactive configuration\n   408â†’async function configure() {\n   409â†’  console.log();\n   410â†’  console.log(color('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', colors.bright + colors.cyan));\n   411â†’  console.log(color('â•‘                    CONFIGURATION SETUP                        â•‘', colors.bright + colors.cyan));\n   412â†’  console.log(color('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', colors.bright + colors.cyan));\n   413â†’  console.log();\n   414â†’  \n   415â†’  let statuslineInstalled = false;\n   416â†’  \n   417â†’  // Developer name section\n   418â†’  console.log(color(`\\n${icons.star} DEVELOPER IDENTITY`, colors.bright + colors.magenta));\n   419â†’  console.log(color('â”€'.repeat(60), colors.dim));\n   420â†’  console.log(color('  Claude will use this name when addressing you in sessions', colors.dim));\n   421â†’  console.log();\n   422â†’  \n   423â†’  const name = await question(color('  Your name: ', colors.cyan));\n   424â†’  if (name) {\n   425â†’    config.developer_name = name;\n   426â†’    console.log(color(`  ${icons.check} Hello, ${name}!`, colors.green));\n   427â†’  }\n   428â†’  \n   429â†’  // Statusline installation section\n   430â†’  console.log(color(`\\n\\n${icons.star} STATUSLINE INSTALLATION`, colors.bright + colors.magenta));\n   431â†’  console.log(color('â”€'.repeat(60), colors.dim));\n   432â†’  console.log(color('  Real-time status display in Claude Code showing:', colors.white));\n   433â†’  console.log(color(`    ${icons.bullet} Current task and DAIC mode`, colors.cyan));\n   434â†’  console.log(color(`    ${icons.bullet} Token usage with visual progress bar`, colors.cyan));\n   435â†’  console.log(color(`    ${icons.bullet} Modified file counts`, colors.cyan));\n   436â†’  console.log(color(`    ${icons.bullet} Open task count`, colors.cyan));\n   437â†’  console.log();\n   438â†’  \n   439â†’  const installStatusline = await question(color('  Install statusline? (y/n): ', colors.cyan));\n   440â†’  \n   441â†’  if (installStatusline.toLowerCase() === 'y') {\n   442â†’    const statuslineSource = path.join(SCRIPT_DIR, 'cc_sessions/scripts/statusline-script.sh');\n   443â†’    try {\n   444â†’      await fs.access(statuslineSource);\n   445â†’      console.log(color('  Installing statusline script...', colors.dim));\n   446â†’      await fs.copyFile(statuslineSource, path.join(PROJECT_ROOT, '.claude/statusline-script.sh'));\n   447â†’      await fs.chmod(path.join(PROJECT_ROOT, '.claude/statusline-script.sh'), 0o755);\n   448â†’      statuslineInstalled = true;\n   449â†’      console.log(color(`  ${icons.check} Statusline installed successfully`, colors.green));\n   450â†’    } catch {\n   451â†’      console.log(color(`  ${icons.warning} Statusline script not found in package`, colors.yellow));\n   452â†’    }\n   453â†’  }\n   454â†’  \n   455â†’  // DAIC trigger phrases section\n   456â†’  console.log(color(`\\n\\n${icons.star} DAIC WORKFLOW CONFIGURATION`, colors.bright + colors.magenta));\n   457â†’  console.log(color('â”€'.repeat(60), colors.dim));\n   458â†’  console.log(color('  The DAIC system enforces discussion before implementation.', colors.white));\n   459â†’  console.log(color('  Trigger phrases tell Claude when you\\'re ready to proceed.', colors.white));\n   460â†’  console.log();\n   461â†’  console.log(color('  Default triggers:', colors.cyan));\n   462â†’  config.trigger_phrases.forEach(phrase => {\n   463â†’    console.log(color(`    ${icons.arrow} \"${phrase}\"`, colors.green));\n   464â†’  });\n   465â†’  console.log();\n   466â†’  console.log(color('  Hint: Common additions: \"implement it\", \"do it\", \"proceed\"', colors.dim));\n   467â†’  console.log();\n   468â†’  \n   469â†’  // Allow adding multiple custom trigger phrases\n   470â†’  let addingTriggers = true;\n   471â†’  while (addingTriggers) {\n   472â†’    const customTrigger = await question(color('  Add custom trigger phrase (Enter to skip): ', colors.cyan));\n   473â†’    if (customTrigger) {\n   474â†’      config.trigger_phrases.push(customTrigger);\n   475â†’      console.log(color(`  ${icons.check} Added: \"${customTrigger}\"`, colors.green));\n   476â†’    } else {\n   477â†’      addingTriggers = false;\n   478â†’    }\n   479â†’  }\n   480â†’  \n   481â†’  // API Mode configuration\n   482â†’  console.log(color(`\\n\\n${icons.star} THINKING BUDGET CONFIGURATION`, colors.bright + colors.magenta));\n   483â†’  console.log(color('â”€'.repeat(60), colors.dim));\n   484â†’  console.log(color('  Token usage is not much of a concern with Claude Code Max', colors.white));\n   485â†’  console.log(color('  plans, especially the $200 tier. But API users are often', colors.white));\n   486â†’  console.log(color('  budget-conscious and want manual control.', colors.white));\n   487â†’  console.log();\n   488â†’  console.log(color('  Sessions was built to preserve tokens across context windows', colors.cyan));\n   489â†’  console.log(color('  but uses saved tokens to enable \\'ultrathink\\' - Claude\\'s', colors.cyan));\n   490â†’  console.log(color('  maximum thinking budget - on every interaction for best results.', colors.cyan));\n   491â†’  console.log();\n   492â†’  console.log(color('  â€¢ Max users (recommended): Automatic ultrathink every message', colors.dim));\n   493â†’  console.log(color('  â€¢ API users: Manual control with [[ ultrathink ]] when needed', colors.dim));\n   494â†’  console.log();\n   495â†’  console.log(color('  You can toggle this anytime with: /api-mode', colors.dim));\n   496â†’  console.log();\n   497â†’  \n   498â†’  const enableUltrathink = await question(color('  Enable automatic ultrathink for best performance? (y/n): ', colors.cyan));\n   499â†’  if (enableUltrathink.toLowerCase() === 'y' || enableUltrathink.toLowerCase() === 'yes') {\n   500â†’    config.api_mode = false;\n   501â†’    console.log(color(`  ${icons.check} Max mode - ultrathink enabled for best performance`, colors.green));\n   502â†’  } else {\n   503â†’    config.api_mode = true;\n   504â†’    console.log(color(`  ${icons.check} API mode - manual ultrathink control (use [[ ultrathink ]])`, colors.green));\n   505â†’  }\n   506â†’  \n   507â†’  // Advanced configuration\n   508â†’  console.log(color(`\\n\\n${icons.star} ADVANCED OPTIONS`, colors.bright + colors.magenta));\n   509â†’  console.log(color('â”€'.repeat(60), colors.dim));\n   510â†’  console.log(color('  Configure tool blocking, task prefixes, and more', colors.white));\n   511â†’  console.log();\n   512â†’  \n   513â†’  const advanced = await question(color('  Configure advanced options? (y/n): ', colors.cyan));\n   514â†’  \n   515â†’  if (advanced.toLowerCase() === 'y') {\n   516â†’    await configureToolBlocking();\n   517â†’    \n   518â†’    // Task prefix configuration\n   519â†’    console.log(color(`\\n\\n${icons.star} TASK PREFIX CONFIGURATION`, colors.bright + colors.magenta));\n   520â†’    console.log(color('â”€'.repeat(60), colors.dim));\n   521â†’    console.log(color('  Task prefixes organize work by priority and type', colors.white));\n   522â†’    console.log();\n   523â†’    console.log(color('  Current prefixes:', colors.cyan));\n   524â†’    console.log(color(`    ${icons.arrow} h- (high priority)`, colors.white));\n   525â†’    console.log(color(`    ${icons.arrow} m- (medium priority)`, colors.white));\n   526â†’    console.log(color(`    ${icons.arrow} l- (low priority)`, colors.white));\n   527â†’    console.log(color(`    ${icons.arrow} ?- (investigate/research)`, colors.white));\n   528â†’    console.log();\n   529â†’    \n   530â†’    const customizePrefixes = await question(color('  Customize task prefixes? (y/n): ', colors.cyan));\n   531â†’    if (customizePrefixes.toLowerCase() === 'y') {\n   532â†’      const high = await question(color('  High priority prefix [h-]: ', colors.cyan)) || 'h-';\n   533â†’      const med = await question(color('  Medium priority prefix [m-]: ', colors.cyan)) || 'm-';\n   534â†’      const low = await question(color('  Low priority prefix [l-]: ', colors.cyan)) || 'l-';\n   535â†’      const inv = await question(color('  Investigate prefix [?-]: ', colors.cyan)) || '?-';\n   536â†’      \n   537â†’      config.task_prefixes = {\n   538â†’        priority: [high, med, low, inv]\n   539â†’      };\n   540â†’      \n   541â†’      console.log(color(`  ${icons.check} Task prefixes updated`, colors.green));\n   542â†’    }\n   543â†’  }\n   544â†’  \n   545â†’  return { statuslineInstalled };\n   546â†’}\n   547â†’\n   548â†’// Save configuration\n   549â†’async function saveConfig(installStatusline = false) {\n   550â†’  console.log(color('Creating configuration...', colors.cyan));\n   551â†’  \n   552â†’  await fs.writeFile(\n   553â†’    path.join(PROJECT_ROOT, 'sessions/sessions-config.json'),\n   554â†’    JSON.stringify(config, null, 2)\n   555â†’  );\n   556â†’  \n   557â†’  // Create or update .claude/settings.json with hooks configuration\n   558â†’  const settingsPath = path.join(PROJECT_ROOT, '.claude/settings.json');\n   559â†’  let settings = {};\n   560â†’  \n   561â†’  // Check if settings.json already exists\n   562â†’  try {\n   563â†’    const existingSettings = await fs.readFile(settingsPath, 'utf-8');\n   564â†’    settings = JSON.parse(existingSettings);\n   565â†’    console.log(color('Found existing settings.json, merging sessions hooks...', colors.cyan));\n   566â†’  } catch {\n   567â†’    console.log(color('Creating new settings.json with sessions hooks...', colors.cyan));\n   568â†’  }\n   569â†’  \n   570â†’  // Define the sessions hooks\n   571â†’  const sessionsHooks = {\n   572â†’    UserPromptSubmit: [\n   573â†’      {\n   574â†’        hooks: [\n   575â†’          {\n   576â†’            type: \"command\",\n   577â†’            command: \"$CLAUDE_PROJECT_DIR/.claude/hooks/user-messages.py\"\n   578â†’          }\n   579â†’        ]\n   580â†’      }\n   581â†’    ],\n   582â†’    PreToolUse: [\n   583â†’      {\n   584â†’        matcher: \"Write|Edit|MultiEdit|Task|Bash\",\n   585â†’        hooks: [\n   586â†’          {\n   587â†’            type: \"command\",\n   588â†’            command: \"$CLAUDE_PROJECT_DIR/.claude/hooks/sessions-enforce.py\"\n   589â†’          }\n   590â†’        ]\n   591â†’      },\n   592â†’      {\n   593â†’        matcher: \"Task\",\n   594â†’        hooks: [\n   595â†’          {\n   596â†’            type: \"command\",\n   597â†’            command: \"$CLAUDE_PROJECT_DIR/.claude/hooks/task-transcript-link.py\"\n   598â†’          }\n   599â†’        ]\n   600â†’      }\n   601â†’    ],\n   602â†’    PostToolUse: [\n   603â†’      {\n   604â†’        hooks: [\n   605â†’          {\n   606â†’            type: \"command\",\n   607â†’            command: \"$CLAUDE_PROJECT_DIR/.claude/hooks/post-tool-use.py\"\n   608â†’          }\n   609â†’        ]\n   610â†’      }\n   611â†’    ],\n   612â†’    SessionStart: [\n   613â†’      {\n   614â†’        matcher: \"startup|clear\",\n   615â†’        hooks: [\n   616â†’          {\n   617â†’            type: \"command\",\n   618â†’            command: \"$CLAUDE_PROJECT_DIR/.claude/hooks/session-start.py\"\n   619â†’          }\n   620â†’        ]\n   621â†’      }\n   622â†’    ]\n   623â†’  };\n   624â†’  \n   625â†’  // Merge hooks (sessions hooks take precedence)\n   626â†’  if (!settings.hooks) {\n   627â†’    settings.hooks = {};\n   628â†’  }\n   629â†’  \n   630â†’  // Merge each hook type\n   631â†’  for (const [hookType, hookConfig] of Object.entries(sessionsHooks)) {\n   632â†’    if (!settings.hooks[hookType]) {\n   633â†’      settings.hooks[hookType] = hookConfig;\n   634â†’    } else {\n   635â†’      // Append sessions hooks to existing ones\n   636â†’      settings.hooks[hookType] = [...settings.hooks[hookType], ...hookConfig];\n   637â†’    }\n   638â†’  }\n   639â†’  \n   640â†’  // Add statusline if requested\n   641â†’  if (installStatusline) {\n   642â†’    settings.statusLine = {\n   643â†’      type: \"command\",\n   644â†’      command: \"$CLAUDE_PROJECT_DIR/.claude/statusline-script.sh\",\n   645â†’      padding: 0\n   646â†’    };\n   647â†’  }\n   648â†’  \n   649â†’  // Save the updated settings\n   650â†’  await fs.writeFile(settingsPath, JSON.stringify(settings, null, 2));\n   651â†’  console.log(color('âœ… Sessions hooks configured in settings.json', colors.green));\n   652â†’  \n   653â†’  // Initialize DAIC state\n   654â†’  await fs.writeFile(\n   655â†’    path.join(PROJECT_ROOT, '.claude/state/daic-mode.json'),\n   656â†’    JSON.stringify({ mode: \"discussion\" }, null, 2)\n   657â†’  );\n   658â†’  \n   659â†’  // Create initial task state\n   660â†’  const currentDate = new Date().toISOString().split('T')[0];\n   661â†’  await fs.writeFile(\n   662â†’    path.join(PROJECT_ROOT, '.claude/state/current_task.json'),\n   663â†’    JSON.stringify({\n   664â†’      task: null,\n   665â†’      branch: null,\n   666â†’      services: [],\n   667â†’      updated: currentDate\n   668â†’    }, null, 2)\n   669â†’  );\n   670â†’}\n   671â†’\n   672â†’// CLAUDE.md integration\n   673â†’async function setupClaudeMd() {\n   674â†’  console.log();\n   675â†’  console.log(color('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', colors.bright));\n   676â†’  console.log(color('         CLAUDE.md Integration', colors.bright));\n   677â†’  console.log(color('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', colors.bright));\n   678â†’  console.log();\n   679â†’  \n   680â†’  // Check for existing CLAUDE.md\n   681â†’  try {\n   682â†’    await fs.access(path.join(PROJECT_ROOT, 'CLAUDE.md'));\n   683â†’    \n   684â†’    // File exists, preserve it and add sessions as separate file\n   685â†’    console.log(color('CLAUDE.md already exists, preserving your project-specific rules...', colors.cyan));\n   686â†’    \n   687â†’    // Copy CLAUDE.sessions.md as separate file\n   688â†’    await fs.copyFile(\n   689â†’      path.join(SCRIPT_DIR, 'cc_sessions/templates/CLAUDE.sessions.md'),\n   690â†’      path.join(PROJECT_ROOT, 'CLAUDE.sessions.md')\n   691â†’    );\n   692â†’    \n   693â†’    // Check if it already includes sessions\n   694â†’    const content = await fs.readFile(path.join(PROJECT_ROOT, 'CLAUDE.md'), 'utf-8');\n   695â†’    if (!content.includes('@CLAUDE.sessions.md')) {\n   696â†’      console.log(color('Adding sessions include to existing CLAUDE.md...', colors.cyan));\n   697â†’      \n   698â†’      const addition = '\\n## Sessions System Behaviors\\n\\n@CLAUDE.sessions.md\\n';\n   699â†’      await fs.appendFile(path.join(PROJECT_ROOT, 'CLAUDE.md'), addition);\n   700â†’      \n   701â†’      console.log(color('âœ… Added @CLAUDE.sessions.md include to your CLAUDE.md', colors.green));\n   702â†’    } else {\n   703â†’      console.log(color('âœ… CLAUDE.md already includes sessions behaviors', colors.green));\n   704â†’    }\n   705â†’  } catch {\n   706â†’    // File doesn't exist, use sessions as CLAUDE.md\n   707â†’    console.log(color('No existing CLAUDE.md found, installing sessions as your CLAUDE.md...', colors.cyan));\n   708â†’    await fs.copyFile(\n   709â†’      path.join(SCRIPT_DIR, 'cc_sessions/templates/CLAUDE.sessions.md'),\n   710â†’      path.join(PROJECT_ROOT, 'CLAUDE.md')\n   711â†’    );\n   712â†’    console.log(color('âœ… CLAUDE.md created with complete sessions behaviors', colors.green));\n   713â†’  }\n   714â†’}\n   715â†’\n   716â†’// Main installation function\n   717â†’async function install() {\n   718â†’  console.log(color('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', colors.bright));\n   719â†’  console.log(color('â•‘            cc-sessions Installer           â•‘', colors.bright));\n   720â†’  console.log(color('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', colors.bright));\n   721â†’  console.log();\n   722â†’  \n   723â†’  // Detect correct project directory\n   724â†’  await detectProjectDirectory();\n   725â†’  \n   726â†’  // Check CLAUDE_PROJECT_DIR\n   727â†’  if (!process.env.CLAUDE_PROJECT_DIR) {\n   728â†’    console.log(color(`âš ï¸  CLAUDE_PROJECT_DIR not set. Setting it to ${PROJECT_ROOT}`, colors.yellow));\n   729â†’    console.log('   To make this permanent, add to your shell profile:');\n   730â†’    console.log(`   export CLAUDE_PROJECT_DIR=\"${PROJECT_ROOT}\"`);\n   731â†’    console.log();\n   732â†’  }\n   733â†’  \n   734â†’  try {\n   735â†’    await checkDependencies();\n   736â†’    await createDirectories();\n   737â†’    await installPythonDeps();\n   738â†’    await copyFiles();\n   739â†’    await installDaicCommand();\n   740â†’    const { statuslineInstalled } = await configure();\n   741â†’    await saveConfig(statuslineInstalled);\n   742â†’    await setupClaudeMd();\n   743â†’    \n   744â†’    // Success message\n   745â†’    console.log();\n   746â†’    console.log();\n   747â†’    console.log(color('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', colors.bright + colors.green));\n   748â†’    console.log(color('â•‘                 ğŸ‰ INSTALLATION COMPLETE! ğŸ‰                  â•‘', colors.bright + colors.green));\n   749â†’    console.log(color('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', colors.bright + colors.green));\n   750â†’    console.log();\n   751â†’    \n   752â†’    console.log(color('  Installation Summary:', colors.bright + colors.cyan));\n   753â†’    console.log(color('  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', colors.dim));\n   754â†’    console.log(color(`  ${icons.check} Directory structure created`, colors.green));\n   755â†’    console.log(color(`  ${icons.check} Hooks installed and configured`, colors.green));\n   756â†’    console.log(color(`  ${icons.check} Protocols and agents deployed`, colors.green));\n   757â†’    console.log(color(`  ${icons.check} daic command available globally`, colors.green));\n   758â†’    console.log(color(`  ${icons.check} Configuration saved`, colors.green));\n   759â†’    console.log(color(`  ${icons.check} DAIC state initialized (Discussion mode)`, colors.green));\n   760â†’    \n   761â†’    if (statuslineInstalled) {\n   762â†’      console.log(color(`  ${icons.check} Statusline configured`, colors.green));\n   763â†’    }\n   764â†’    \n   765â†’    console.log();\n   766â†’    \n   767â†’    // Test daic command\n   768â†’    if (commandExists('daic')) {\n   769â†’      console.log(color(`  ${icons.check} daic command verified and working`, colors.green));\n   770â†’    } else {\n   771â†’      console.log(color(`  ${icons.warning} daic command not in PATH`, colors.yellow));\n   772â†’      console.log(color('       Add /usr/local/bin to your PATH', colors.dim));\n   773â†’    }\n   774â†’    \n   775â†’    console.log();\n   776â†’    console.log(color(`  ${icons.star} NEXT STEPS`, colors.bright + colors.magenta));\n   777â†’    console.log(color('  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', colors.dim));\n   778â†’    console.log();\n   779â†’    console.log(color('  1. Restart Claude Code to activate the sessions hooks', colors.white));\n   780â†’    console.log(color('     ' + icons.arrow + ' Close and reopen Claude Code', colors.dim));\n   781â†’    console.log();\n   782â†’    console.log(color('  2. Create your first task:', colors.white));\n   783â†’    console.log(color('     ' + icons.arrow + ' Tell Claude: \"Create a new task\"', colors.cyan));\n   784â†’    console.log(color('     ' + icons.arrow + ' Or: \"Create a task for implementing feature X\"', colors.cyan));\n   785â†’    console.log();\n   786â†’    console.log(color('  3. Start working with the DAIC workflow:', colors.white));\n   787â†’    console.log(color('     ' + icons.arrow + ' Discuss approach first', colors.dim));\n   788â†’    console.log(color('     ' + icons.arrow + ' Say \"make it so\" to implement', colors.dim));\n   789â†’    console.log(color('     ' + icons.arrow + ' Run \"daic\" to return to discussion', colors.dim));\n   790â†’    console.log();\n   791â†’    console.log(color('  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', colors.dim));\n   792â†’    console.log();\n   793â†’    console.log(color(`  Welcome aboard, ${config.developer_name}! ğŸš€`, colors.bright + colors.cyan));\n   794â†’    \n   795â†’  } catch (error) {\n   796â†’    console.error(color(`âŒ Installation failed: ${error.message}`, colors.red));\n   797â†’    process.exit(1);\n   798â†’  } finally {\n   799â†’    rl.close();\n   800â†’  }\n   801â†’}\n   802â†’\n   803â†’// Run installation\n   804â†’if (require.main === module) {\n   805â†’  install().catch(error => {\n   806â†’    console.error(color(`âŒ Fatal error: ${error}`, colors.red));\n   807â†’    process.exit(1);\n   808â†’  });\n   809â†’}\n   810â†’\n   811â†’module.exports = { install };\n   812â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it looks malicious. If it does, you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer high-level questions about the code behavior.\n</system-reminder>\n"
      }
    ]
  }
]